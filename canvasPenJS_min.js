/*=== "canvasPenJS/canvasPenJS_min.js" Copyright (c) 2016 Yuji SODE <yuji.sode@gmail.com> ===
*    This software is released under the MIT License. See LICENSE or http://opensource.org/licenses/mit-license.php
*/
function _canvasPenJS(canvas,rgba,w,plot){var slf=window,cvs=slf.document.getElementById(canvas.id),I=0,n=0,c,x=0,y=0,Rect,log={time:0,d:[],canvasId:canvas.id},reg=/^(?:\+|\-)?[0-9]+(?:\.[0-9]+)?@(?:\+|\-)?[0-9]+(?:\.[0-9]+)?$/,plotFlg,evnt=[['mousedown','mouseup','mousemove','mouseout'],['mouseup'],['touchstart','touchmove','touchend']];plotFlg=reg.test(plot);/*Reference[1]: "MDN: Element.getBoundingClientRect()"*/Rect=!!cvs.getBoundingClientRect()?cvs.getBoundingClientRect():{top:0,left:0};function touch2MouseEvt(e){e.preventDefault();if(!!e.changedTouches&&e.changedTouches.length>0){var touch0=e.changedTouches[0],newMEvt=function(EventName,tObj,tgt){var E=new MouseEvent(EventName,{'view':window,'bubbles':true,'cancelable':true,'clientX':tObj.clientX,'clientY':tObj.clientY});tgt.dispatchEvent(E);};switch(e.type){case 'touchstart':newMEvt('mousedown',touch0,e.target);break;case 'touchmove':newMEvt('mousemove',touch0,e.target);break;case 'touchend':newMEvt('mouseup',touch0,e.target);break;}}else{return;}}if(!plot){var dr=function(e){if(!dr.d){dr.d=[false,0,0];}var D=dr.d;if(!(e.type!='mousedown')){D[0]=true,D[1]=e.clientX-Rect.left,D[2]=e.clientY-Rect.top;log.d.push(D[1]+'@'+D[2]);}else if(!(e.type!='mouseup')){D[0]=false,x=e.clientX-Rect.left,y=e.clientY-Rect.top;log.d.push(x+'@'+y);}else if(!(e.type!='mousemove')||!(e.type!='mouseout')){if(D[0]){x=e.clientX-Rect.left,y=e.clientY-Rect.top;c=cvs.getContext('2d'),c.strokeStyle=rgba,c.lineWidth=w;c.beginPath(),c.moveTo(D[1],D[2]),c.lineTo(x,y),c.stroke();D[1]=x,D[2]=y;c.strokeStyle='rgba(0,0,0,1)',c.lineWidth=1;if(!(e.type!='mouseout')){D[0]=false;log.d.push(x+'@'+y);}}}};}else if(!!plotFlg){var pltData=function(){c=cvs.getContext('2d'),c.strokeStyle=rgba,c.lineWidth=w;x=+plot.split(/@/)[0],y=+plot.split(/@/)[1];c.strokeRect(x,y,1,1);log.d.push(plot);c.strokeStyle='rgba(0,0,0,1)',c.lineWidth=1;};}else{var plt=function(e){c=cvs.getContext('2d'),c.strokeStyle=rgba,c.lineWidth=w;x=e.clientX-Rect.left,y=e.clientY-Rect.top;c.strokeRect(x,y,1,1);log.d.push(x+'@'+y);c.strokeStyle='rgba(0,0,0,1)',c.lineWidth=1;};}cvs=slf.document.getElementById(canvas.id),n=evnt[2].length,I=0;while(I<n){cvs.addEventListener(evnt[2][I],touch2MouseEvt,true),I+=1;}if(!plot){n=evnt[0].length,I=0;log.d=[],log.time='drawing:'+slf.Date().replace(/\s/g,'_')+' to ';while(I<n){cvs.addEventListener(evnt[0][I],dr,true),I+=1;}return function(){cvs=slf.document.getElementById(canvas.id),I=0;log.time+=slf.Date().replace(/\s/g,'_');while(I<n){cvs.removeEventListener(evnt[0][I],dr,true),I+=1;}if(!c){c=cvs.getContext('2d');}c.strokeStyle='rgba(0,0,0,1)',c.lineWidth=1;return log;};}else if(!!plotFlg){log.d=[],log.time='plotting with data (x@y):'+slf.Date().replace(/\s/g,'_');pltData();return function(){if(!c){c=cvs.getContext('2d');}c.strokeStyle='rgba(0,0,0,1)',c.lineWidth=1;return log;};}else{log.d=[],log.time='plotting:'+slf.Date().replace(/\s/g,'_')+' to ';cvs.addEventListener(evnt[1][0],plt,true);return function(){cvs=slf.document.getElementById(canvas.id);log.time+=slf.Date().replace(/\s/g,'_');cvs.removeEventListener(evnt[1][0],plt,true);if(!c){c=cvs.getContext('2d');}c.strokeStyle='rgba(0,0,0,1)',c.lineWidth=1;return log;};}}
/*=== "canvasPenJS/canvasPenJS_min.js" (Yuji SODE,2016,the MIT License) ===
* Reference[1]: "MDN: Element.getBoundingClientRect()"derived on 2016-12-28 and from: https://developer.mozilla.org/en/docs/Web/API/Element/getBoundingClientRect
*/
